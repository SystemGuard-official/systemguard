<aside id="sidebar"
    class="fixed top-0 left-0 z-40 h-screen w-80 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out bg-white shadow-xl border-r border-gray-100 flex flex-col">
    <!-- Logo Section -->
    <div class="p-6 bg-gradient-to-br from-blue-800 to-purple-600 text-white shadow-lg ">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <div class="relative">
                    <div
                        class="flex items-center justify-center h-14 w-14 bg-white/30 backdrop-blur-md rounded-full text-white font-bold text-xl shadow-lg">
                        SG
                    </div>
                    <div
                        class="absolute -bottom-1 -right-1 h-5 w-5 bg-green-500 border-2 border-white rounded-full animate-pulse">
                    </div>
                </div>
                <div class="flex-1">
                    <a href="{{ url_for('dashboard') }}" class="block">
                        <h1 class="text-2xl font-extrabold">{{ title }}</h1>
                        <p class="text-sm text-white/90">Monitoring, Managing, Mastering Security</p>
                    </a>
                </div>
            </div>
            <button type="button"
                class="lg:hidden p-2.5 text-white hover:bg-white/20 rounded-lg transition duration-300"
                onclick="toggleSidebar()">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
    </div>


    <!-- Stats Preview -->
    <!-- <div class="px-4 py-4 bg-gradient-to-b from-blue-50 via-purple-50 to-white">
        <div class="rounded-2xl bg-white p-4 shadow-lg border border-purple-100/50 transition-all duration-300 hover:shadow-xl hover:border-purple-200">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold bg-gradient-to-r from-blue-600 to-purple-600 text-transparent bg-clip-text">Quick Insights</h3>
                <span class="text-xs px-2 py-1 rounded-full bg-blue-100 text-blue-700 font-medium animate-pulse">Live</span>
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div class="p-4 rounded-xl bg-gradient-to-br from-blue-50 to-blue-100 shadow-md hover:shadow-xl transition-all duration-300 group">
                    <div class="text-3xl font-extrabold text-blue-600 group-hover:scale-110 transition-transform duration-300">1.0.0</div>
                    <div class="text-sm text-gray-600 font-medium">SystemGuard Version</div>
                </div>
                <div class="p-4 rounded-xl bg-gradient-to-br from-yellow-50 to-yellow-100 shadow-md hover:shadow-xl transition-all duration-300 group">
                    <div class="text-3xl font-extrabold text-yellow-600 response-time group-hover:scale-110 transition-transform duration-300">0.5ms</div>
                    <div class="text-sm text-gray-600 font-medium">Response Time</div>
                </div>
                
            </div>
        </div>
    </div> -->

    <!-- Navigation -->
    <nav class="flex-1 overflow-y-auto px-4 py-2 ">
        <div class="space-y-6">
            <!-- Metrics Section -->
            <div>
                <p class="px-2 text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3">Metrics</p>
                <div class="space-y-2">
                    <a href="{{ url_for('historical_system_metrics') }}"
                        class="group flex items-center px-3 py-2 text-sm font-medium rounded-xl transition-all duration-200 {% if request.endpoint == 'historical_system_metrics' %}bg-gradient-to-r from-indigo-50 to-purple-50 text-indigo-700{% else %}text-gray-600 hover:bg-gray-100{% endif %}">
                        <div
                            class="flex-shrink-0 h-8 w-8 flex items-center justify-center rounded-lg {% if request.endpoint == 'historical_system_metrics' %}bg-indigo-100 text-indigo-600{% else %}bg-gray-100 group-hover:bg-indigo-100 group-hover:text-indigo-600{% endif %}">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <span class="ml-2">Historical Metrics</span>
                    </a>

                    {% if plan_type in ['Core', 'Pro', 'Enterprise'] %}
                    <a href="{{ url_for('get_summary_metrics') }}"
                        class="group flex items-center px-3 py-2 text-sm font-medium rounded-xl transition-all duration-200 {% if request.endpoint == 'get_summary_metrics' %}bg-gradient-to-r from-indigo-50 to-purple-50 text-indigo-700{% else %}text-gray-600 hover:bg-gray-100{% endif %}">
                        <div
                            class="flex-shrink-0 h-8 w-8 flex items-center justify-center rounded-lg {% if request.endpoint == 'get_summary_metrics' %}bg-indigo-100 text-indigo-600{% else %}bg-gray-100 group-hover:bg-indigo-100 group-hover:text-indigo-600{% endif %}">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                        <span class="ml-2">Summary Metrics</span>
                    </a>
                    {% else %}
                    <a href="#"
                        class="group flex items-center px-3 py-2 text-sm font-medium rounded-xl transition-all duration-200 text-gray-400 cursor-not-allowed"
                        title="Available in Enterprise version">
                        <div
                            class="flex-shrink-0 h-8 w-8 flex items-center justify-center rounded-lg bg-gray-100 text-gray-400">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                        <span class="ml-2">Summary Metrics</span>
                    </a>
                    {% endif %}
                </div>
            </div>

            <!-- System Section -->

            <div>
                <p class="px-2 text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">System</p>
                <div class="space-y-1">

                    <a href="{{ url_for('show_system_services') }}"
                        class="group flex items-center px-3 py-2 text-sm font-medium rounded-xl transition-all duration-200 {% if request.endpoint == 'show_system_services' %}bg-gradient-to-r from-indigo-50 to-purple-50 text-indigo-700{% else %}text-gray-600 hover:bg-gray-100{% endif %}">
                        <div
                            class="flex-shrink-0 h-8 w-8 flex items-center justify-center rounded-lg {% if request.endpoint == 'show_system_services' %}bg-indigo-100 text-indigo-600{% else %}bg-gray-100 group-hover:bg-indigo-100 group-hover:text-indigo-600{% endif %}">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <span class="ml-2">System Process</span>
                    </a>

                    {% if plan_type in ['Core', 'Pro', 'Enterprise'] %}
                    <a href="{{ url_for('alert_history') }}"
                        class="group flex items-center px-3 py-2 text-sm font-medium rounded-xl transition-all duration-200 {% if request.endpoint == 'alert_history' %}bg-gradient-to-r from-indigo-50 to-purple-50 text-indigo-700{% else %}text-gray-600 hover:bg-gray-100{% endif %}">
                        <div
                            class="flex-shrink-0 h-8 w-8 flex items-center justify-center rounded-lg {% if request.endpoint == 'alert_history' %}bg-indigo-100 text-indigo-600{% else %}bg-gray-100 group-hover:bg-indigo-100 group-hover:text-indigo-600{% endif %}">
                            <i class="fas fa-bell"></i>
                        </div>
                        <span class="ml-2">Alert Tracker</span>
                    </a>
                    {% else %}
                    <a href="#"
                        class="group flex items-center px-3 py-2 text-sm font-medium rounded-xl transition-all duration-200 text-gray-400 cursor-not-allowed"
                        title="Available in Enterprise version">
                        <div
                            class="flex-shrink-0 h-8 w-8 flex items-center justify-center rounded-lg bg-gray-100 text-gray-400">
                            <i class="fas fa-bell"></i>
                        </div>
                        <span class="ml-2">Alert Tracker</span>
                    </a>
                    {% endif %}


                    <!-- discussion_board -->
                    {% if plan_type in ['Core', 'Pro', 'Enterprise'] %}

                    <a href="{{ url_for('discussion_board') }}"
                        class="group flex items-center px-3 py-2 text-sm font-medium rounded-xl transition-all duration-200 {% if request.endpoint == 'discussion_board' %}bg-gradient-to-r from-indigo-50 to-purple-50 text-indigo-700{% else %}text-gray-600 hover:bg-gray-100{% endif %}">
                        <div
                            class="flex-shrink-0 h-8 w-8 flex items-center justify-center rounded-lg {% if request.endpoint == 'discussion_board' %}bg-indigo-100 text-indigo-600{% else %}bg-gray-100 group-hover:bg-indigo-100 group-hover:text-indigo-600{% endif %}">
                            <i class="fas fa-comments"></i>
                        </div>
                        <span class="ml-2">Discussion Board</span>
                    </a>
                    {% else %}
                    <a href="#"
                        class="group flex items-center px-3 py-2 text-sm font-medium rounded-xl transition-all duration-200 text-gray-400 cursor-not-allowed"
                        title="Available in Enterprise version">
                        <div
                            class="flex-shrink-0 h-8 w-8 flex items-center justify-center rounded-lg bg-gray-100 text-gray-400">
                            <i class="fas fa-comments"></i>
                        </div>
                        <span class="ml-2">Discussion Board</span>
                    </a>
                    {% endif %}

                    <!-- unified_logger -->
                    {% if plan_type in ['Core', 'Pro', 'Enterprise'] %}
                    <a href="{{ url_for('unified_logger') }}"
                        class="group flex items-center px-3 py-2 text-sm font-medium rounded-xl transition-all duration-200 {% if request.endpoint == 'unified_logger' %}bg-gradient-to-r from-indigo-50 to-purple-50 text-indigo-700{% else %}text-gray-600 hover:bg-gray-100{% endif %}">
                        <div
                            class="flex-shrink-0 h-8 w-8 flex items-center justify-center rounded-lg {% if request.endpoint == 'unified_logger' %}bg-indigo-100 text-indigo-600{% else %}bg-gray-100 group-hover:bg-indigo-100 group-hover:text-indigo-600{% endif %}">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <span class="ml-2">Unified Logger</span>
                    </a>
                    {% else %}
                    <a href="#"
                        class="group flex items-center px-3 py-2 text-sm font-medium rounded-xl transition-all duration-200 text-gray-400 cursor-not-allowed"
                        title="Available in Enterprise version">
                        <div
                            class="flex-shrink-0 h-8 w-8 flex items-center justify-center rounded-lg bg-gray-100 text-gray-400">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <span class="ml-2">Unified Logger</span>
                    </a>
                    {% endif %}
            </div>
        </div>

        <!-- Security Section -->
        {% if current_user.user_level == 'admin' %}
        <div>
            <p class="px-2 text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">Security</p>
            {% if plan_type in ['Core', 'Pro', 'Enterprise'] %}
            <div class="space-y-1">
                <a href="{{ url_for('firewall') }}"
                    class="group flex items-center px-3 py-2 text-sm font-medium rounded-xl transition-all duration-200 {% if request.endpoint == 'firewall' %}bg-gradient-to-r from-indigo-50 to-purple-50 text-indigo-700{% else %}text-gray-600 hover:bg-gray-100{% endif %}">
                    <div
                        class="flex-shrink-0 h-8 w-8 flex items-center justify-center rounded-lg {% if request.endpoint == 'firewall' %}bg-indigo-100 text-indigo-600{% else %}bg-gray-100 group-hover:bg-indigo-100 group-hover:text-indigo-600{% endif %}">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <span class="ml-2">Firewall</span>
                </a>
            </div>
            {% else %}
            <div class="space-y-1">
                <a href="#"
                    class="group flex items-center px-3 py-2 text-sm font-medium rounded-xl transition-all duration-200 text-gray-400 cursor-not-allowed"
                    title="Available in Enterprise version">
                    <div
                        class="flex-shrink-0 h-8 w-8 flex items-center justify-center rounded-lg bg-gray-100 text-gray-400">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <span class="ml-2">Firewall</span>
                </a>
            </div>  
            {% endif %}
        </div>
        {% endif %}

        <!-- Settings Section -->
        <div>
            <p class="px-2 text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">Settings</p>
            <div class="space-y-1">
                {% if current_user.user_level == 'admin' %}
                {% if plan_type in ['Core', 'Pro', 'Enterprise'] %}
                <a href="{{ url_for('configure_targets') }}"
                    class="group flex items-center px-3 py-2 text-sm font-medium rounded-xl transition-all duration-200 {% if request.endpoint == 'configure_targets' %}bg-gradient-to-r from-indigo-50 to-purple-50 text-indigo-700{% else %}text-gray-600 hover:bg-gray-100{% endif %}">
                    <div
                        class="flex-shrink-0 h-8 w-8 flex items-center justify-center rounded-lg {% if request.endpoint == 'configure_targets' %}bg-indigo-100 text-indigo-600{% else %}bg-gray-100 group-hover:bg-indigo-100 group-hover:text-indigo-600{% endif %}">
                        <i class="fas fa-network-wired"></i>
                    </div>
                    <span class="ml-2">Configure Target</span>
                </a>
                {% else %}
                <a href="#"
                    class="group flex items-center px-3 py-2 text-sm font-medium rounded-xl transition-all duration-200 text-gray-400 cursor-not-allowed"
                    title="Available in Enterprise version">
                    <div
                        class="flex-shrink-0 h-8 w-8 flex items-center justify-center rounded-lg bg-gray-100 text-gray-400">
                        <i class="fas fa-network-wired"></i>
                    </div>
                    <span class="ml-2">Configure Target</span>
                </a>
                {% endif %}
                {% endif %}
                {% if current_user.user_level == 'admin' %}
                {% if plan_type in ['Core', 'Pro', 'Enterprise'] %}
                <a href="{{ url_for('manage_rules') }}"
                    class="group flex items-center px-3 py-2 text-sm font-medium rounded-xl transition-all duration-200 {% if request.endpoint == 'manage_rules' %}bg-gradient-to-r from-indigo-50 to-purple-50 text-indigo-700{% else %}text-gray-600 hover:bg-gray-100{% endif %}">
                    <div
                        class="flex-shrink-0 h-8 w-8 flex items-center justify-center rounded-lg {% if request.endpoint == 'manage_rules' %}bg-indigo-100 text-indigo-600{% else %}bg-gray-100 group-hover:bg-indigo-100 group-hover:text-indigo-600{% endif %}">
                        <i class="fas fa-bell"></i>
                    </div>
                    <span class="ml-2">Configure Rules</span>
                </a>
                {% else %}
                <a href="#"
                    class="group flex items-center px-3 py-2 text-sm font-medium rounded-xl transition-all duration-200 text-gray-400 cursor-not-allowed"
                    title="Available in Enterprise version">
                    <div
                        class="flex-shrink-0 h-8 w-8 flex items-center justify-center rounded-lg bg-gray">
                        <i class="fas fa-bell"></i>
                    </div>
                    <span class="ml-2">Configure Rules</span>
                </a>
                {% endif %}
                {% endif %}

                <!-- activation -->
                {% if current_user.user_level == 'admin' %}
                <a href="{{ url_for('activation') }}"
                    class="group flex items-center px-3 py-2 text-sm font-medium rounded-xl transition-all duration-200 {% if request.endpoint == 'activation' %}bg-gradient-to-r from-indigo-50 to-purple-50 text-indigo-700{% else %}text-gray-600 hover:bg-gray-100{% endif %}">
                    <div
                        class="flex-shrink-0 h-8 w-8 flex items-center justify-center rounded-lg {% if request.endpoint == 'activation' %}bg-indigo-100 text-indigo-600{% else %}bg-gray-200 group-hover:bg-indigo-100 group-hover:text-indigo-600{% endif %}">
                        <i
                            class="fas fa-key w-5 h-5 mr-2 {% if request.endpoint == 'activation' %}text-indigo-600{% else %}text-gray-400 group-hover:text-indigo-600{% endif %} transition-colors duration-200"></i>
                    </div>
                    <span class="ml-2">Product Activation</span>
                </a>
                {% endif %}

                {% if current_user.user_level == 'admin' %}
                <a href="{{ url_for('view_users') }}"
                    class="group flex items-center px-3 py-2 text-sm font-medium rounded-xl transition-all duration-200 {% if request.endpoint == 'view_users' %}bg-gradient-to-r from-indigo-50 to-purple-50 text-indigo-700{% else %}text-gray-600 hover:bg-gray-100{% endif %}">
                    <div
                        class="flex-shrink-0 h-8 w-8 flex items-center justify-center rounded-lg {% if request.endpoint == 'view_users' %}bg-indigo-100 text-indigo-600{% else %}bg-gray-100 group-hover:bg-indigo-100 group-hover:text-indigo-600{% endif %}">
                        <i
                            class="fas fa-users w-5 h-5 mr-2 {% if request.endpoint == 'view_users' %}text-indigo-600{% else %}text-gray-400 group-hover:text-indigo-600{% endif %} transition-colors duration-200"></i>
                    </div>
                    <span class="ml-2">User Management</span>
                </a>
                {% endif %}

                <a href="{{ url_for('settings') }}"
                    class="group flex items-center px-3 py-2 text-sm font-medium rounded-xl transition-all duration-200 {% if request.endpoint == 'settings' %}bg-gradient-to-r from-indigo-50 to-purple-50 text-indigo-700{% else %}text-gray-600 hover:bg-gray-100{% endif %}">
                    <div
                        class="flex-shrink-0 h-8 w-8 flex items-center justify-center rounded-lg {% if request.endpoint == 'settings' %}bg-indigo-100 text-indigo-600{% else %}bg-gray-100 group-hover:bg-indigo-100 group-hover:text-indigo-600{% endif %}">
                        <i class="fas fa-cogs"></i>
                    </div>
                    <span class="ml-2">Control Panel</span>
                </a>
            </div>
        </div>

        <!-- Help Section -->
        <div>
            <p class="px-2 text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">About</p>
            <div class="space-y-1">
                <a href="{{ url_for('about') }}"
                    class="group flex items-center px-3 py-2 text-sm font-medium rounded-xl transition-all duration-200 {% if request.endpoint == 'about' %}bg-gradient-to-r from-indigo-50 to-purple-50 text-indigo-700{% else %}text-gray-600 hover:bg-gray-100{% endif %}">
                    <i
                        class="fas fa-info-circle w-5 h-5 mr-2 {% if request.endpoint == 'about' %}text-indigo-600{% else %}text-gray-400 group-hover:text-indigo-600{% endif %} transition-colors duration-200"></i>
                    <span class="ml-2">About {{ title }}</span>
                </a>
            </div>
        </div>
        </div>
    </nav>

    <!-- User Profile -->
    {% if current_user.is_authenticated %}
    <div class="relative bg-white shadow-sm rounded-lg mt-4">
        <!-- User Profile Section -->
        <div class="p-4 sm:p-6">
            <div class="flex items-center space-x-3">
                <!-- Avatar Section with Gradient Border -->
                <div class="relative">
                    <div
                        class="absolute -inset-0.5 bg-gradient-to-r from-blue-600 to-purple-600 rounded-full blur opacity-75">
                    </div>
                    <div class="relative rounded-full h-12 w-12 ring-2 ring-white overflow-hidden">
                        <img src="{{ current_user.get_profile_picture_url() }}" alt="Profile Image"
                            class="h-full w-full object-cover">
                    </div>
                    <span
                        class="absolute bottom-0 right-0 block h-3 w-3 rounded-full ring-2 ring-white bg-green-500"></span>
                </div>

                <!-- User Info -->
                <div class="flex-1 min-w-0">
                    <h3 class="text-sm font-semibold text-gray-900 truncate">
                        {{ current_user.first_name | capitalize }} {{ current_user.last_name | capitalize }}
                    </h3>
                    <span class="text-xs text-blue-900 truncate">{{ current_user.email }}</span>
                </div>

                <!-- Menu Button and Dropdown -->
                <div class="relative">
                    <!-- Dropdown Menu - Positioned Above -->
                    <div id="dropdownMenu"
                        class="dropdown-menu hidden absolute bottom-full right-0 mb-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 py-1 z-50">
                        <a href="{{ url_for('view_profile') }}"
                            class="group flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">
                            <i class="fas fa-user w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"></i>
                            View Profile
                        </a>

                        <a href="{{ url_for('settings') }}"
                            class="group flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">
                            <i class="fas fa-cog w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"></i>
                            Settings
                        </a>

                        <div class="border-t border-gray-100 my-1"></div>

                        <a href="{{ url_for('logout') }}"
                            class="group flex items-center px-4 py-2 text-red-700 hover:bg-red-50">
                            <i class="fas fa-sign-out-alt w-5 h-5 mr-3 text-red-400 group-hover:text-red-500"></i>
                            Logout User
                        </a>

                        {% if current_user.user_level == 'admin' and session.get('sudo_password') %}
                        <form id="shutdown-form">
                            <button type="button" onclick="submitAction('shutdown')"
                                class="group flex items-center px-4 py-2 text-red-700 hover:bg-red-50 w-full text-left">
                                <i class="fas fa-power-off w-5 h-5 mr-3 text-red-400 group-hover:text-red-500"></i>
                                Shutdown Server
                            </button>
                        </form>

                        <form id="reboot-form">
                            <button type="button" onclick="submitAction('reboot')"
                                class="group flex items-center px-4 py-2 text-red-700 hover:bg-red-50 w-full text-left">
                                <i class="fas fa-sync-alt w-5 h-5 mr-3 text-red-400 group-hover:text-red-500"></i>
                                Reboot Server
                            </button>
                        </form>
                        {% endif %}
                    </div>
                    <!-- Menu Button -->
                    <button onclick="toggleDropdown()"
                        class="p-2 rounded-full hover:bg-gray-100 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        <i class="fas fa-ellipsis-v w-5 h-5 text-gray-400"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</aside>

<script>
    function toggleDropdown() {
        const dropdown = document.getElementById('dropdownMenu');
        dropdown.classList.toggle('hidden');

        // Close dropdown when clicking outside
        document.addEventListener('click', function closeDropdown(e) {
            const dropdownButton = e.target.closest('button');
            const dropdownMenu = e.target.closest('#dropdownMenu');

            if (!dropdownButton && !dropdownMenu) {
                dropdown.classList.add('hidden');
                document.removeEventListener('click', closeDropdown);
            }
        });
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', function (event) {
        const isClickInside = event.target.closest('button') || event.target.closest('#dropdownMenu');
        if (!isClickInside) {
            document.getElementById('dropdownMenu').classList.add('hidden');
        }
    });

    async function submitAction(action) {
        const response = await fetch("{{ url_for('utility_control_api') }}", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ action: action })
        });

        const result = await response.json();
        if (!response.ok) {
            alert(result.error || "An error occurred");
        } else {
            alert(result.message || "Action completed successfully");
        }
    }

</script>

<!-- Sidebar Overlay -->
<div class="fixed inset-0 z-30 bg-gray-600/60 backdrop-blur-md lg:hidden hidden" id="sidebar-overlay"
    onclick="toggleSidebar()"></div>